name: Build Docs Container
run-name: Build Docs Container by @{{github.actor}}

on:
  workflow_call:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}-test
  cancel-in-progress: true

permissions:
    id-token: write
    contents: read
    packages: write

jobs:
    build_and_push_docker_ghcr:
        runs-on: [ubuntu-latest]

        steps:
            - uses: actions/checkout@v4
            - name: Set short git commit SHA
              shell: bash
              id: vars
              run: |
                calculatedSha=$(git rev-parse --short ${{ github.sha }})
                echo "COMMIT_SHORT_SHA=$calculatedSha" >> $GITHUB_ENV

            - name: Confirm git commit SHA output
              shell: bash
              run: |
                echo ${{ vars.env.COMMIT_SHORT_SHA }}   

            - name: Build Docker Image
              uses: docker/build-push-action@v5
              with:
                  context: ./docs
                  file: Dockerfile
                  tags: ghcr.io/cdcgov/dibbs-cloud/docs:${{ vars.env.COMMIT_SHORT_SHA }}